var g=Object.defineProperty;var v=(h,e,t)=>e in h?g(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var a=(h,e,t)=>v(h,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class r{constructor(e,t){this.x=e,this.y=t}add(e){return new r(this.x+e.x,this.y+e.y)}sub(e){return new r(this.x-e.x,this.y-e.y)}scale(e){return new r(this.x*e,this.y*e)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.length();return e===0?new r(0,0):new r(this.x/e,this.y/e)}distanceTo(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}}class u{constructor(e,t,i,s){a(this,"game");a(this,"position");a(this,"velocity");a(this,"radius",4);a(this,"damage",10);a(this,"duration",2);a(this,"active",!0);this.game=e,this.position=new r(t,i),this.velocity=s}update(e){this.position.x+=this.velocity.x*e,this.position.y+=this.velocity.y*e,this.duration-=e,this.duration<=0&&(this.active=!1)}onHit(e){this.active=!1}draw(e){e.save(),e.translate(this.position.x,this.position.y),e.fillStyle="#00ffff",e.beginPath(),e.arc(0,0,this.radius,0,Math.PI*2),e.fill(),e.restore()}}class w{constructor(e,t,i){a(this,"position");a(this,"velocity");a(this,"speed",200);a(this,"radius",15);a(this,"hp",100);a(this,"maxHp",100);a(this,"damage",10);a(this,"game");a(this,"multiShotLevel",0);a(this,"magnetRadius",100);a(this,"shootCooldown",0);a(this,"attackInterval",.5);this.game=e,this.position=new r(t,i),this.velocity=new r(0,0)}update(e){const t=this.game.input,i=new r(0,0);(t.keys.w||t.keys.ArrowUp)&&(i.y-=1),(t.keys.s||t.keys.ArrowDown)&&(i.y+=1),(t.keys.a||t.keys.ArrowLeft)&&(i.x-=1),(t.keys.d||t.keys.ArrowRight)&&(i.x+=1);const s=i.normalize();this.position.x+=s.x*this.speed*e,this.position.y+=s.y*this.speed*e,this.shootCooldown-=e,this.shootCooldown<=0&&(this.shootNearestEnemy(),this.shootCooldown=this.attackInterval)}shootNearestEnemy(){let e=null,t=1/0;for(const i of this.game.enemies){const s=this.position.distanceTo(i.position);s<t&&(t=s,e=i)}if(e&&t<600){const i=e.position.sub(this.position).normalize(),s=400;if(this.fireProjectile(i,s),this.multiShotLevel>0)for(let o=1;o<=this.multiShotLevel;o++){const n=Math.PI/12*o,l=Math.cos(n),c=Math.sin(n),p=new r(i.x*l-i.y*c,i.x*c+i.y*l),m=Math.cos(-n),y=Math.sin(-n),f=new r(i.x*m-i.y*y,i.x*y+i.y*m);this.fireProjectile(p,s),this.fireProjectile(f,s)}}}fireProjectile(e,t){const i=e.scale(t),s=new u(this.game,this.position.x,this.position.y,i);s.damage=this.damage,this.game.projectiles.push(s)}draw(e){e.save(),e.translate(this.position.x,this.position.y),e.fillStyle="#FFD700",e.beginPath(),e.ellipse(0,0,20,10,0,0,Math.PI*2),e.fill(),e.fillStyle="#A9A9A9",e.fillRect(-5,-15,4,10),e.fillRect(-5,-17,10,4),e.restore()}takeDamage(e){this.hp-=e,this.hp<=0&&(this.hp=0,this.game.gameOver())}}class x{constructor(e,t,i,s){a(this,"game");a(this,"position");a(this,"value",10);a(this,"radius",5);a(this,"active",!0);this.game=e,this.position=new r(t,i),this.value=s}update(e){if(this.position.distanceTo(this.game.player.position)<100){const i=this.game.player.position.sub(this.position).normalize();this.position.x+=i.x*300*e,this.position.y+=i.y*300*e}}draw(e){e.fillStyle="#00ff00",e.beginPath(),e.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),e.fill()}}class b{constructor(e,t,i,s){a(this,"game");a(this,"position");a(this,"active",!0);a(this,"stats");a(this,"hp");a(this,"animTime",0);this.game=e,this.position=new r(t,i),this.stats=s||{id:"default",name:"Fish",hp:10,speed:80,radius:12,color:"#ff4444",xp:10,score:10},this.hp=this.stats.hp}update(e){this.animTime+=e;const t=this.game.player.position.sub(this.position).normalize();let i=this.stats.speed;if(this.stats.behavior==="snake"){const s=Math.sin(this.animTime*10)*.5,o=new r(-t.y,t.x);this.position.x+=(t.x+o.x*s)*i*e,this.position.y+=(t.y+o.y*s)*i*e}else this.stats.behavior==="crab"?(this.animTime%1.5<.5&&(i=0),this.position.x+=t.x*i*e,this.position.y+=t.y*i*e):(this.position.x+=t.x*i*e,this.position.y+=t.y*i*e)}draw(e){e.save(),e.translate(this.position.x,this.position.y),e.fillStyle=this.stats.color;const t=this.game.player.position.sub(this.position),i=Math.atan2(t.y,t.x);e.rotate(i),this.drawShape(e),e.restore()}drawShape(e){const t=this.stats.radius;if(e.beginPath(),this.stats.id==="crab")e.ellipse(0,0,t,t*.8,0,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t,-t/2,t/2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t,t/2,t/2,0,Math.PI*2),e.fill();else if(this.stats.id==="shark"||this.stats.id==="fish_medium")e.moveTo(t,0),e.lineTo(-t,t),e.lineTo(-t,-t),e.fill(),e.beginPath(),e.moveTo(-t,0),e.lineTo(-t-5,5),e.lineTo(-t-5,-5),e.fill();else if(this.stats.id==="ray")e.moveTo(t,0),e.lineTo(0,t),e.lineTo(-t,0),e.lineTo(0,-t),e.fill();else if(this.stats.id==="squid"){e.ellipse(0,0,t,t/2,0,0,Math.PI*2),e.fill(),e.strokeStyle=this.stats.color,e.lineWidth=2;for(let i=-2;i<=2;i++)e.beginPath(),e.moveTo(0,i*4),e.lineTo(-t*1.5,i*4+Math.sin(this.animTime*10+i)*5),e.stroke()}else e.arc(0,0,t,0,Math.PI*2),e.fill()}takeDamage(e){this.hp-=e,this.hp<=0&&(this.active=!1,this.game.score+=this.stats.score,this.game.xpOrbs.push(new x(this.game,this.position.x,this.position.y,this.stats.xp)))}get radius(){return this.stats.radius}}class d extends u{constructor(t,i){super(t,0,0,new r(0,0));a(this,"angle",0);a(this,"orbitRadius",60);a(this,"orbitSpeed",3);a(this,"isRecovering",!1);a(this,"recoveryTime",2);a(this,"currentRecovery",0);this.angle=i,this.radius=8,this.damage=5,this.duration=1/0}update(t){this.isRecovering&&(this.currentRecovery-=t,this.currentRecovery<=0&&(this.isRecovering=!1)),this.angle+=this.orbitSpeed*t;const i=this.game.player.position;this.position.x=i.x+Math.cos(this.angle)*this.orbitRadius,this.position.y=i.y+Math.sin(this.angle)*this.orbitRadius}onHit(t){this.isRecovering=!0,this.currentRecovery=this.recoveryTime}draw(t){this.isRecovering||(t.save(),t.translate(this.position.x,this.position.y),t.fillStyle="#00ffaa",t.beginPath(),t.arc(0,0,this.radius,0,Math.PI*2),t.fill(),t.restore())}}const M=[{id:"rapid_fire",name:"Rapid Fire",description:"Increases firing speed by 10%",rarity:"common",icon:"âš¡",type:"stat",stat:"attackInterval",value:.9,op:"multiply"},{id:"heavy_torpedo",name:"Heavy Torpedo",description:"Increases damage by 20%",rarity:"common",icon:"ðŸ’£",type:"stat",stat:"damage",value:1.2,op:"multiply"},{id:"engine_boost",name:"Engine Boost",description:"Increases movement speed by 10%",rarity:"common",icon:"ðŸ’¨",type:"stat",stat:"speed",value:1.1,op:"multiply"},{id:"reinforced_hull",name:"Reinforced Hull",description:"Increases Max HP by 20",rarity:"common",icon:"ðŸ›¡ï¸",type:"stat",stat:"maxHp",value:20,op:"add"},{id:"multi_shot",name:"Multi-Shot",description:"Fires an additional projectile",rarity:"legendary",icon:"ðŸ”±",type:"special",effect:"increment_multishot"},{id:"protection_ring",name:"Protection Ring",description:"Summons an orbiting projectile",rarity:"rare",icon:"ðŸ’«",type:"special",effect:"increment_protection_ring"},{id:"magnet",name:"XP Magnet",description:"Increases XP pickup range",rarity:"common",icon:"ðŸ§²",type:"stat",stat:"magnetRadius",value:1.5,op:"multiply"}];class T{constructor(e){a(this,"game");a(this,"upgrades");a(this,"playerUpgrades",new Map);this.game=e,this.upgrades=M}getRandomUpgrades(e=3){const t=[];for(;t.length<e;){const i=Math.random();let s="common";i>.95?s="legendary":i>.7&&(s="rare");const o=this.upgrades.filter(l=>l.rarity===s);if(o.length===0)continue;const n=o[Math.floor(Math.random()*o.length)];t.includes(n)||t.push(n)}return t}applyUpgrade(e){if(this.playerUpgrades.has(e.id)?this.playerUpgrades.get(e.id).count++:this.playerUpgrades.set(e.id,{def:e,count:1}),e.type==="stat"&&e.stat){const t=this.game.player;e.op==="multiply"?t[e.stat]*=e.value:t[e.stat]+=e.value,e.stat==="maxHp"&&(t.hp+=e.value)}else if(e.type==="special"){if(e.effect==="increment_multishot")this.game.player.multiShotLevel++;else if(e.effect==="increment_protection_ring"){const t=this.playerUpgrades.get(e.id).count;this.game.projectiles=this.game.projectiles.filter(i=>!(i instanceof d));for(let i=0;i<t;i++){const s=Math.PI*2/t*i;this.game.projectiles.push(new d(this.game,s))}}}}getInventory(){return Array.from(this.playerUpgrades.values())}}const P=[{id:"fish_small",name:"Guppy",hp:5,speed:100,radius:8,color:"#ff6b6b",xp:5,score:5,weight:50},{id:"fish_medium",name:"Piranha",hp:15,speed:120,radius:12,color:"#ff4444",xp:10,score:10,weight:30},{id:"crab",name:"Armored Crab",hp:40,speed:50,radius:15,color:"#ff8c00",xp:20,score:20,weight:20,behavior:"crab"},{id:"eel",name:"Electric Eel",hp:20,speed:150,radius:10,color:"#ffff00",xp:25,score:30,weight:15,behavior:"snake"},{id:"angler",name:"Angler Fish",hp:60,speed:70,radius:18,color:"#800080",xp:40,score:50,weight:10},{id:"squid",name:"Giant Squid",hp:120,speed:60,radius:25,color:"#ff00ff",xp:100,score:100,weight:5},{id:"shark",name:"Great White",hp:200,speed:140,radius:30,color:"#708090",xp:200,score:150,weight:3},{id:"turtle",name:"Ancient Turtle",hp:300,speed:30,radius:28,color:"#228b22",xp:150,score:120,weight:5},{id:"ray",name:"Manta Ray",hp:80,speed:110,radius:22,color:"#4682b4",xp:60,score:60,weight:8},{id:"abyss_horror",name:"Abyss Horror",hp:500,speed:40,radius:40,color:"#000000",xp:500,score:500,weight:1}];class I{constructor(e){a(this,"canvas");a(this,"ctx");a(this,"lastTime",0);a(this,"player");a(this,"input",{keys:{}});a(this,"enemies",[]);a(this,"projectiles",[]);a(this,"xpOrbs",[]);a(this,"upgradeManager");a(this,"score",0);a(this,"level",1);a(this,"xp",0);a(this,"xpToNextLevel",100);a(this,"isPaused",!1);a(this,"isGameOver",!1);a(this,"camera",new r(0,0));this.canvas=e,this.ctx=e.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize()),this.setupInput(),this.setupRestart(),this.player=new w(this,0,0),this.upgradeManager=new T(this)}setupRestart(){const e=document.getElementById("restart-btn");e&&(e.onclick=()=>{location.reload()})}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}setupInput(){window.addEventListener("keydown",e=>{this.input.keys[e.key]=!0}),window.addEventListener("keyup",e=>{this.input.keys[e.key]=!1})}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}loop(e){const t=(e-this.lastTime)/1e3;this.lastTime=e,!this.isPaused&&!this.isGameOver&&this.update(t),this.draw(),requestAnimationFrame(this.loop.bind(this))}update(e){this.player.update(e),this.camera.x=this.player.position.x-this.canvas.width/2,this.camera.y=this.player.position.y-this.canvas.height/2,this.enemies.forEach(t=>t.update(e)),this.enemies=this.enemies.filter(t=>t.active),this.projectiles.forEach(t=>t.update(e)),this.projectiles=this.projectiles.filter(t=>t.active),this.xpOrbs.forEach(t=>t.update(e)),this.xpOrbs=this.xpOrbs.filter(t=>t.active),Math.random()<.02&&this.spawnEnemy(),this.checkCollisions(),this.updateUI()}spawnEnemy(){const e=Math.random()*Math.PI*2,t=Math.max(this.canvas.width,this.canvas.height)/2+50,i=new r(this.player.position.x+Math.cos(e)*t,this.player.position.y+Math.sin(e)*t),s=P,o=s.reduce((c,p)=>c+p.weight||10,0);let n=Math.random()*o,l=s[0];for(const c of s){const p=c.weight||10;if(n<p){l=c;break}n-=p}this.enemies.push(new b(this,i.x,i.y,l))}checkCollisions(){for(const e of this.enemies)e.position.distanceTo(this.player.position)<e.radius+this.player.radius&&this.player.takeDamage(10*.016);for(const e of this.projectiles)if(!(e instanceof d&&e.isRecovering)){for(const t of this.enemies)if(e.position.distanceTo(t.position)<e.radius+t.radius){t.takeDamage(e.damage),e.onHit(t);break}}for(const e of this.xpOrbs)e.position.distanceTo(this.player.position)<e.radius+this.player.radius&&(this.collectXP(e.value),e.active=!1)}collectXP(e){this.xp+=e,this.xp>=this.xpToNextLevel&&this.levelUp()}levelUp(){this.level++,this.xp-=this.xpToNextLevel,this.xpToNextLevel=Math.floor(this.xpToNextLevel*1.2),this.showUpgradeMenu()}showUpgradeMenu(){this.isPaused=!0;const e=document.getElementById("upgrade-menu"),t=document.getElementById("upgrade-options");if(!e||!t)return;e.style.display="flex",t.innerHTML="",this.upgradeManager.getRandomUpgrades(3).forEach(s=>{const o=document.createElement("div");o.className=`upgrade-card rarity-${s.rarity}`,o.innerHTML=`
            <div class="upgrade-icon">${s.icon}</div>
            <h3>${s.name}</h3>
            <p>${s.description}</p>
            <div class="rarity-badge">${s.rarity.toUpperCase()}</div>
          `,o.onclick=()=>{this.upgradeManager.applyUpgrade(s),this.resumeGame()},t.appendChild(o)})}resumeGame(){const e=document.getElementById("upgrade-menu");e&&(e.style.display="none"),this.isPaused=!1,this.lastTime=performance.now(),this.updateUI()}updateUI(){const e=document.getElementById("score");e&&(e.innerText=this.score.toString());const t=document.getElementById("level");t&&(t.innerText=this.level.toString());const i=document.getElementById("hp-bar"),s=document.getElementById("hp-text");if(i&&s){const l=this.player.hp/this.player.maxHp*100;i.style.width=`${Math.max(0,l)}%`,s.innerText=`${Math.ceil(this.player.hp)} / ${this.player.maxHp}`}const o=document.getElementById("xp-bar");if(o){const l=this.xp/this.xpToNextLevel*100;o.style.width=`${l}%`}const n=document.getElementById("inventory");n&&(n.innerHTML="",this.upgradeManager.getInventory().forEach(c=>{const p=document.createElement("div");p.className="inv-item",p.title=`${c.def.name} (Rank ${c.count})`,p.innerHTML=`
                <div class="inv-icon">${c.def.icon}</div>
                <div class="inv-rank">${c.count}</div>
              `,n.appendChild(p)}))}gameOver(){this.isGameOver=!0;const e=document.getElementById("death-screen");if(e){e.style.display="flex";const t=document.getElementById("death-level"),i=document.getElementById("death-score");t&&(t.innerText=this.level.toString()),i&&(i.innerText=this.score.toString())}}draw(){this.ctx.fillStyle="#001e36",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(-this.camera.x,-this.camera.y),this.drawBackgroundGrid(),this.xpOrbs.forEach(e=>e.draw(this.ctx)),this.enemies.forEach(e=>e.draw(this.ctx)),this.projectiles.forEach(e=>e.draw(this.ctx)),this.player.draw(this.ctx),this.ctx.restore()}drawBackgroundGrid(){const t=Math.floor(this.camera.x/100)*100,i=Math.floor(this.camera.y/100)*100;this.ctx.strokeStyle="#003366",this.ctx.lineWidth=1,this.ctx.beginPath();for(let s=t;s<this.camera.x+this.canvas.width+100;s+=100)this.ctx.moveTo(s,this.camera.y),this.ctx.lineTo(s,this.camera.y+this.canvas.height);for(let s=i;s<this.camera.y+this.canvas.height+100;s+=100)this.ctx.moveTo(this.camera.x,s),this.ctx.lineTo(this.camera.x+this.canvas.width,s);this.ctx.stroke()}}const E=document.getElementById("gameCanvas"),k=new I(E);k.start();
